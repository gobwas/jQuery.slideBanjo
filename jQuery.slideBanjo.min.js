/*!
 * jQuery.slideBanjo - plugin that shows pretty slides at your site.
 * http://www.gobwas.com/sbanjo
 * Version: 1.0 beta.
 *
 * Copyright 2011, Sergey Kamardin.
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Tue June 22 15:00:00 2011 +0300.
 * Location: Moscow, Russia.
 * Contact: gobwas[a]gobwas.com
 */
 
(function(c){c.fn.slideBanjo=function(f,n){if(this[0].tagName!="DIV")return this;var k,l,m,j;k=c("<div/>").addClass("sm_menu").appendTo(document.body);l=c("<div/>").addClass("sm_menu_current").appendTo(document.body);m=c("<div/>").addClass("sm_navis").appendTo(document.body);j=c("<div/>").addClass("sm_slide").appendTo(document.body);temp_e=c("<div/>").addClass("sm_caption_holder").appendTo(document.body);var o=k.height(),p=l.height(),q=m.height(),r={height:j.height(),width:j.width()},s={height:temp_e.height(),
width:temp_e.width()};k.remove();l.remove();m.remove();j.remove();temp_e.remove();var a={temp:{makeTempObjects:void 0,grid:100,a:o,b:p,c:q,slide:r,captionHolder:s,deleteTempObjects:void 0},slide:{globalCounter:0,changeStatus:"auto"},navigation:{changeStatus:"auto",slider:!1,kslider:null},bottom:{},current:null,total:f.length,current_pic:null,total_pic:null,articles:[],abstracts:[],menus:[],arrows:[],chs:[],contents:[],blocks:[],slides_loader:[],total_loading:0,total_loaded:0,slides:[],captions:[],
captionToggle:!0,global_div:c(this).removeClass().addClass("sm_global"),naviST:!1,userOptions:{navigationScrollTime:"auto",slideScrollTime:5E3,sliderEasing:"easeInBack",easing:"easeOutCirc",moveSpeed:700,sliderSpeed:500,loopX:"loop",blockEffect:"blind",blockEffectSpeed:300,hideMouseOver:!0,hideMouseTime:3E3,innerShadow:!0,loadingText:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043b\u0430\u0439\u0434\u043e\u0432."}};c.extend(a.userOptions,n);a.draw=function(){this.banjo_div=c("<div/>").addClass("sm_banjo").appendTo(this.global_div).disableSelection();
this.slide_div=c("<div/>").addClass("sm_slide_holder").appendTo(this.banjo_div);if(this.userOptions.innerShadow)this.inner_shadow=c("<div/>").addClass("sm_inner_shadow").appendTo(this.slide_div).bind("click",function(){a.slide.captionToggle()});this.slide_caption_div=c("<div/>").addClass("sm_caption_holder").appendTo(this.slide_div);this.userOptions.hideMouseOver&&this.slide_caption_div.bind("mouseover",function(){a.slide_caption_div.stop().animate({opacity:1})}).bind("mouseout",function(){a.hideMouseFunc()}).bind("mousemove",
function(){clearTimeout(c.data(a.slide_caption_div,"timeoutID"))});this.left_div=c("<button/>").addClass("sm_left").appendTo(this.slide_caption_div).bind("click",function(b){a.slide.userChange("left",b)});this.right_div=c("<button/>").addClass("sm_right").appendTo(this.slide_caption_div).bind("click",function(b){a.slide.userChange("right",b)});this.navigation_div=c("<div/>").addClass("sm_navis").appendTo(this.banjo_div);this.banjo_div.append(c("<div/>").css("clear","both"));this.loading_div=c("<div/>").addClass("sm_loading").appendTo(this.global_div);
this.drawSlider();this.init();this.loadSlides();this.navigation.autoChange()};a.drawSlider=function(){if(!((this.total-1)*(this.temp.a+1)+this.temp.b<this.temp.c)){this.navigation.kslider=this.temp.c/((this.total-1)*(this.temp.a+1)+this.temp.b+this.temp.grid);var b=Math.round(this.temp.c*this.navigation.kslider);this.slider_bar_div=c("<div/>").addClass("sm_slider_bar").appendTo(this.navigation_div);this.slider=c("<div/>").addClass("sm_slider").appendTo(this.slider_bar_div).draggable({axis:"y",containment:a.slider_bar_div,
start:function(){},drag:function(b,d){a.global_div.find(".sm_menu").css("top",Math.round(-d.position.top/a.navigation.kslider)+"px")},stop:function(){}}).css("height",b+"px");a.navigation.slider=!0}};a.init=function(){for(var b in f){this.articles[b]=c("<div/>").addClass("sm_article").html(f[b].name).disableSelection();this.abstracts[b]=c("<div/>").addClass("sm_abstract").html(f[b].abstr).disableSelection();this.menus[b]=c("<div/>").addClass("sm_menu").append(this.articles[b]).append(this.abstracts[b]).appendTo(this.navigation_div).disableSelection().bind("click",
function(b){return function(){a.navigation.userChange(b)}}(b));this.chs[b]=c("<div/>").addClass("sm_ch").html(f[b].name).appendTo(this.global_div).disableSelection();this.contents[b]=c("<div/>").addClass("sm_content").html(f[b].content).appendTo(this.global_div).disableSelection();this.blocks[b]=c("<div/>").addClass("sm_blocks").appendTo(this.contents[b]).disableSelection();for(var g in f[b].blocks){var d=c("<div/>").addClass("sm_block").appendTo(this.blocks[b]),e=c("<a/>").addClass("sm_block_title").html(f[b].blocks[g].title).appendTo(d),
d=c("<div/>").addClass("sm_block_text").html(f[b].blocks[g].text).appendTo(d);e.bind("click",function(b){return function(){b.toggle(a.userOptions.blockEffect,a.userOptions.blockEffectSpeed);a.navigation.changeStatus="user"}}(d))}this.arrows[b]=c("<div/>").addClass("sm_arrow").appendTo(this.menus[b]);var e=[],d=[],i;for(i in f[b].pics){this.total_loading++;var h=c("<img/>").addClass("sm_slide").css({left:i*a.temp.slide.width+"px",top:b*a.temp.slide.height+"px"}).bind("click",function(){a.slide.captionToggle()}),
j=c("<div/>").addClass("sm_caption").html(f[b].pics[i].caption).appendTo(this.slide_caption_div);i==0?(h.attr({title:f[b].pics[i].caption,src:f[b].pics[i].path}),h.appendTo(this.slide_div),e.push(h),d.push(j),this.total_loaded++):this.slides_loader.push({x:b,img:h,cpt:j,src:f[b].pics[i].path,pos:i})}this.slides[b]=e;this.captions[b]=d}this.navishadow=c("<div/>").addClass("sm_navishadow").appendTo(this.navigation_div);d=this.userOptions.loadingText+" "+String(this.total_loaded)+"/"+String(this.total_loading);
this.loading_div.html(d)};a.loadSlides=function(){for(var b in a.slides_loader){var c=a.slides_loader[b];c.img.appendTo(a.slide_div).load(function(b){return function(){a.slides[b.x][b.pos]=b.img;a.captions[b.x][b.pos]=b.cpt;if(a.current==b.x)a.total_pic=a.slides[b.x].length;a.current==b.x&&a.slides[b.x].length>1&&a.slide.captionButtonsToggle(!0);a.loadProgress()}}(c)).attr("src",c.src)}};a.loadProgress=function(){this.total_loaded++;this.loading_div.html(this.userOptions.loadingText+" "+String(this.total_loaded)+
"/"+String(this.total_loading));this.total_loaded==this.total_loading&&this.loading_div.fadeOut(100,function(a){return function(){a.remove()}}(this.loading_div))};a.test=function(a){alert(a)};a.navigation.autoChange=function(){if(this.changeStatus=="auto"){a.current+1>=a.total||a.current==null?this.changeEffect(0):this.changeEffect(a.current+1);if(a.userOptions.navigationScrollTime=="auto"||a.naviST==!0)a.naviST=!0,a.userOptions.navigationScrollTime=Number(a.total_pic*a.userOptions.slideScrollTime);
this.changeStatus=="auto"&&setTimeout(function(){a.navigation.autoChange()},a.userOptions.navigationScrollTime)}};a.navigation.userChange=function(a){this.changeStatus="user";this.changeEffect(a)};a.navigation.changeEffect=function(b){a.slide.changeStatus="auto";a.current!=null&&(a.menus[a.current].removeClass("sm_menu_current"),a.articles[a.current].removeClass("sm_article_current"),a.abstracts[a.current].removeClass("sm_abstract_current"),a.arrows[a.current].removeClass("sm_arrow_current"));a.menus[b].stop(!1,
!0).addClass("sm_menu_current");a.articles[b].addClass("sm_article_current");a.abstracts[b].addClass("sm_abstract_current");a.arrows[b].addClass("sm_arrow_current");a.bottom.globalChange(b);a.navigation.slider&&a.navigation.slide(b);a.slide.captionChange(b,0);a.current!=b&&a.slide.globalChange(b);a.current=b;a.userOptions.hideMouseOver&&a.hideMouseFunc()};a.navigation.slide=function(b){var b=a.menus[b].position().top,g=null;if(b-a.temp.grid<=0){for(var d=0,g=c(".sm_slider").position().top;g-Math.round(d*
this.kslider)>0&&b+d-a.temp.grid<0;)d+=1;g=Math.round(-d*this.kslider)}else b+a.temp.b+a.temp.grid>a.temp.c&&(d=a.temp.c-(b+a.temp.b+a.temp.grid),g=Math.round(-d*this.kslider));g!=null&&(a.slider.stop().animate({top:a.slider.position().top+g+"px"},a.userOptions.sliderSpeed,a.userOptions.sliderEasing),a.global_div.find(".sm_menu").stop().animate({top:a.global_div.find(".sm_menu").position().top+d+"px"},a.userOptions.sliderSpeed,a.userOptions.sliderEasing))};a.slide.autoChange=function(b){a.slide.changeStatus!=
"auto"||b!=a.slide.globalCounter||(this.changeEffect("right"),this.changeStatus=="auto"&&setTimeout(function(b){return function(){a.slide.autoChange(b)}}(b),a.userOptions.slideScrollTime),a.userOptions.hideMouseOver&&a.hideMouseFunc())};a.slide.userChange=function(b,g){clearTimeout(c.data(a.slide_caption_div,"timeoutID"));c(g.target).attr("disabled","disabled");a.slide.changeStatus="user";a.navigation.changeStatus="user";var d=function(a){return function(){c(a).removeAttr("disabled")}}(g.target);
this.changeEffect(b,d)};a.slide.globalChange=function(b){a.total_pic=a.slides[b].length;a.current_pic=0;a.slide.globalCounter+=1;for(var c in a.slides)for(var d in a.slides[c])a.slides[c][d].stop().animate({top:(c-b)*a.temp.slide.height+"px"},a.userOptions.moveSpeed,a.userOptions.easing,function(b,c){return function(){a.slides[b][c].animate({left:c*a.temp.slide.width+"px"},a.userOptions.moveSpeed/2,a.userOptions.easing)}}(c,d));a.total_pic<=1?a.slide.captionButtonsToggle(!1):(a.slide.captionButtonsToggle(!0),
setTimeout(function(b){return function(){a.slide.autoChange(b)}}(a.slide.globalCounter),a.userOptions.slideScrollTime))};a.slide.captionChange=function(b,c){a.current!=null&&a.captions[a.current][a.current_pic].hide(0);a.captions[b][c].show("slide",a.userOptions.moveSpeed)};a.slide.captionButtonsToggle=function(b){b===!0?(a.left_div.removeAttr("disabled").fadeIn(a.userOptions.moveSpeed),a.right_div.removeAttr("disabled").fadeIn(a.userOptions.moveSpeed)):(a.left_div.attr("disabled","disabled").fadeOut(a.userOptions.moveSpeed),
a.right_div.attr("disabled","disabled").fadeOut(a.userOptions.moveSpeed))};a.slide.captionToggle=function(b){b==void 0&&(b=!a.captionToggle);b===!0?(a.slide_caption_div.stop().animate({left:"0px",opacity:1},a.userOptions.moveSpeed),a.captionToggle=!0):(a.slide_caption_div.stop().animate({left:-a.temp.captionHolder.width-5+"px",opacity:0.3},a.userOptions.moveSpeed),a.captionToggle=!1)};a.slide.changeEffect=function(b,c){var d=!1;b=="right"&&a.current_pic+1<a.total_pic&&(a.slide.captionChange(a.current,
a.current_pic+1),a.current_pic+=1,d=!0);b=="left"&&a.current_pic-1>=0&&(a.slide.captionChange(a.current,a.current_pic-1),a.current_pic-=1,d=!0);if(d)for(var e in a.slides[a.current])a.slides[a.current][e].animate({left:(e-a.current_pic)*a.temp.slide.width+"px"},a.userOptions.moveSpeed,a.userOptions.easing);else switch(a.userOptions.loopX){case "backward":for(e in a.slides[a.current])a.slides[a.current][e].animate({left:e*a.temp.slide.width+"px"},a.userOptions.moveSpeed,a.userOptions.easing);a.slide.captionChange(a.current,
0);a.current_pic=0;break;case "loop":a.captions[a.current][a.current_pic].fadeOut(0);var d=0,f=[],h=[];if(b=="left"){d=-1;zz=a.slides[a.current].length;for(e=a.slides[a.current].length-1;e>=0;e--)e!=a.current_pic?(d+=1,zz-=1,a.slides[a.current][e].css({left:1-zz*a.temp.slide.width+"px"}),f[d]=a.slides[a.current][e],h[d]=a.captions[a.current][e]):(a.slides[a.current][e].css({left:"0px"}),f[a.slides[a.current].length-1]=a.slides[a.current][e],h[a.slides[a.current].length-1]=a.captions[a.current][e]);
a.current_pic=a.slides[a.current].length-1}else{for(e in a.slides[a.current])e!=a.current_pic?(d+=1,a.slides[a.current][e].css({left:d*a.temp.slide.width+"px"}),f[d]=a.slides[a.current][e],h[d]=a.captions[a.current][e]):(a.slides[a.current][e].css({left:"0px"}),f[0]=a.slides[a.current][e],h[0]=a.captions[a.current][e]);a.current_pic=0}a.slides[a.current]=f;a.captions[a.current]=h;this.changeEffect(b);break;case "prohibit":return}typeof c=="function"&&setTimeout(c,a.userOptions.moveSpeed)};a.bottom.globalChange=
function(b){a.current!=null&&(a.chs[a.current].hide(),a.contents[a.current].hide());a.chs[b].show();a.contents[b].show()};a.hideMouseFunc=function(){a.slide_caption_div.stop().animate({opacity:1},function(){var b=setTimeout(function(){a.slide_caption_div.stop().animate({opacity:0})},a.userOptions.hideMouseTime);c.data(a.slide_caption_div,"timeoutID",b)})};a.draw();return this}})(jQuery);